<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.58.3" />
    <title>
      
        istio envoy log type 
      
    </title>
    <link rel="stylesheet" type="text/css" href="https://zecoo.github.io/hugo/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://zecoo.github.io/hugo/css/classes.css">
    <link rel="stylesheet" href="https://zecoo.github.io/hugo/css/github.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  </head>

  <body>
    <div class="container">
      
<aside id="meta">
    <div>
    <section>
      <p id="date"> Wed May 6, 2020 </p>
      <p id="wordcount"> 84 Words </p>
    </section>
    
    
    <ul id="tags">
      
        <li> <a href="https://zecoo.github.io/hugo/tagsistio">istio</a> </li>
      
    </ul>
    
    </div>
</aside>
<section id="main">
  <h1 id="title">istio envoy log type</h1>
  <div>
        <article id="content">
           

<p>基本数据这样</p>

<pre><code class="language-shell">【START_TIME】[2020-05-06T09:32:24.488Z] 
【METHOD】&quot;GET 【PATH】/flasgger_static/swagger-ui-bundle.js 【PROTOCOL】HTTP/1.1&quot; 
【REPONSE CODE】200 - &quot;-&quot; &quot;-&quot; 0 1048149 261 225 
【FORWARD_FOR】&quot;-&quot; 
【AGENT】&quot;Mozilla/5.0 (pc-x86_64-linux-gnu) Siege/4.0.5&quot;
【REQUEST_ID】&quot;51b45953-9ede-9390-b8b5-162247165a5b&quot;
【AUTHORITY】&quot;10.108.208.232:8000&quot; 
【HOST】&quot;127.0.0.1:80&quot; 
inbound|8000|http|httpbin.default.svc.cluster.local 127.0.0.1:43000 10.244.0.67:80 10.244.0.1:10504 - default
</code></pre>

<pre><code class="language-basic">0 135 1 1            (/status/418)
0 9593 73 73         (http/1.1)
0 1428809 1 1        (swagger-ui.bundle.js)
0 85578 1 0          (jquery.min.js)
0 0 118 -            (DC ResponseCode:0)
0 1048149 261 225    (swagger-ui.bundle.js)
</code></pre>

<p>那么这4串数字分别代表什么呢？根据Envoy官方给出的对应关系，由于HTTP_FLAGS一般都是比较特别的，而我得到的都是&rdquo;-&ldquo;，可以得到对应关系：</p>

<pre><code class="language-shell">[1]BYTES_RECEIVED [2]BYTES_SENT [3]DURATION [4]ENVOY-UPSTREAM-SERVICE-TIME
</code></pre>

<p>istio bookinfo示例中给出的log是这样（官方给出的，我现在不想折腾Mixer，得不到这个数据）</p>

<pre><code class="language-shell">{&quot;level&quot;:&quot;warn&quot;,&quot;time&quot;:&quot;2018-09-15T20:46:35.982761Z&quot;,&quot;instance&quot;:&quot;newlog.xxxxx.istio-system&quot;,&quot;destination&quot;:&quot;productpage&quot;,&quot;latency&quot;:&quot;968.030256ms&quot;,&quot;responseCode&quot;:200,&quot;responseSize&quot;:4415,&quot;source&quot;:&quot;istio-ingressgateway&quot;,&quot;user&quot;:&quot;unknown&quot;}
</code></pre>

<p>区别的重点在于 samples/bookinfo/telemetry/log-entry.yaml 这个文件。</p>

<p>但是如果要log的话，要用到Mixer这个组件，然而Mixer已经被官方弃用了，怎么官方文档还是要这玩意儿？</p>

<p>中文文档更新得好慢啊，Envoy获取log已经不在英文的文档里了…</p>

<h2 id="参考">参考</h2>

<p><a href="https://github.com/istio/istio/tree/master/mixer">https://github.com/istio/istio/tree/master/mixer</a> （Mixer被弃用）</p>

<p><a href="https://istio-releases.github.io/v0.1/docs/tasks/installing-istio.html">https://istio-releases.github.io/v0.1/docs/tasks/installing-istio.html</a> （安装Mixer）</p>

<p><a href="https://www.envoyproxy.cn/configurationreference/accesslogging">https://www.envoyproxy.cn/configurationreference/accesslogging</a> （envoy access log format 中文文档）</p>

<p><a href="https://blog.csdn.net/luo15242208310/article/details/98745143">https://blog.csdn.net/luo15242208310/article/details/98745143</a> （用彩色区分了不同的log部分）</p>

        </article>
  </div>
</section>

    </div>
    
    
    <script src="https://zecoo.github.io/hugo/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>